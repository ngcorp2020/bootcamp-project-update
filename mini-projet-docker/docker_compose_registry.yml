version: "3.8"

services:
  registry:
    image: registry:2
    container_name: registry
    restart: always
    ports:
      - "5000:5000"
    environment:
      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /var/lib/registry
      # CORS HEADERS (OBLIGATOIRES POUR L’UI)
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: '["*"]'
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: '["HEAD","GET","OPTIONS","DELETE"]'
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: '["Authorization","Accept","Cache-Control"]'
      REGISTRY_HTTP_HEADERS_Access-Control-Expose-Headers: '["Docker-Content-Digest"]'
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Credentials: '["true"]'
    volumes:
      - registry-data:/var/lib/registry

  registry-ui:
    image: quiq/registry-ui:latest
    container_name: registry-ui
    restart: always
    ports:
      - "8081:8000"   # UI accessible via localhost:8081
    environment:
      REGISTRY_HOSTNAME: "registry:5000"   # Nom du service docker registry
      REGISTRY_INSECURE: "true"            # HTTP autorisé
    depends_on:
      - registry

volumes:
  registry-data:
